checkout:
  post:
    - git submodule sync
    - git submodule update --init

machine:
  node:
    version:
      5.6
  java:
    version:
      oraclejdk8

general:
  artifacts:
    - "graffitab.jar"
  branches:
    only:
      - master # list of branches to build
      - /feature.*/ # or regexes

dependencies:
  override:
    #- ./gradlew buildClient -Penv=openshiftDev
    - ./gradlew dependencies -Penv=openshiftDev

test:
  override:
    - echo "Skipping test"

# Need to add one valid private SSH Key to CircleCI UI so it can authenticate against Openshift
deployment:
  staging:
    branch: feature/openshift-deployment
    commands:
      - git fetch --unshallow
      - git push $OPENSHIFT_REMOTE_GIT_REPO $CIRCLE_SHA1:master -f
      - ./gradlew pollForStartup -Penv=openshiftDev
