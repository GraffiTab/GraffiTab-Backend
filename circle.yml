checkout:
  post:
    - git submodule sync
    - git submodule update --init

machine:
  java:
    version:
      oraclejdk8

general:
  artifacts:
    - "graffitab.jar"

dependencies:
  override:
    - ./gradlew buildClient -Penv=herokuDev
    - ./gradlew dependencies -Penv=herokuDev

database:
  override:
    - ./gradlew updateDb -Penv=herokuDev

test:
  override:
    - ./gradlew test -Penv=herokuDev

deployment:
  staging:
    branch: master
    commands:
      - "[[ ! -s \"$(git rev-parse --git-dir)/shallow\" ]] || git fetch --unshallow"
      - git push git@heroku.com:graffitab.git $CIRCLE_SHA1:master
      - ./gradlew stage -Penv=herokuDev
